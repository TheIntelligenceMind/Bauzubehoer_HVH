<%@page import="entity.WarenkorbArtikel"%>
<%@page import="entity.Artikel"%>
<%@page import="java.util.List"%>

<!-- 
Autor dieser Datei: Tim Hermbecker, Lukas Vechtel

Diese Datei behandelt die Anzeige von Artikeln fÃ¼r den Kunden.
Hier wird auch eine gefilterte Suche mit ausgegeben.
 -->

<script type="text/javascript">
	var accept = true;

	function artikelDetailansichtAnzeigen(artikelnummer){
		$(document).ready(function() {
			if(accept){
				window.location.href = "suchen?method=artikelDetailansichtAnzeigen&artikelnummer=" + artikelnummer;  
			}   
		});
	}
	
	function verfuegbareMengePruefen2(lagermenge){	
		var result = true;
		if(lagermenge <= 0){	
			result = confirm("Die ausgewählte Menge ist derzeit nicht auf Lager verfügbar. "
					+ "Sollten Sie diese Menge trotzdem bestellen wollen, dauert die Lieferung länger als üblich.");
		}	
		accept = result;
		
		return result;
	}
</script>

<div class="showing" id="artikelListeKunden">
	<div id="artikelKundenTabellen">
       	<%
		     	List<?> artikelListe = null;		     	
		     	artikelListe = ((List<?>)request.getAttribute("artikelliste"));
		     	
		     	if(artikelListe != null){
		     		for(Object o : artikelListe){
			     		Artikel a = (Artikel)o;
			     		String anzeigenBild = a.getBildasString();
			     		
			     		String buttonText = "In den Warenkorb";
			     		String buttonClass = "enabledBtn";
			     		String buttonDisabled = "";
			     		List<?> warenkorbartikelListeA = (List<?>)session.getAttribute("warenkorbartikelliste");
			     		
			     		if(anzeigenBild == null){
			     			anzeigenBild = "";
			     		}   		
			     		
			     		if(warenkorbartikelListeA != null){
			     			for(Object oa : warenkorbartikelListeA){
			     				WarenkorbArtikel warenkorbartikela = (WarenkorbArtikel)oa;
			     				if(warenkorbartikela.getArtikel().getNummer() == a.getNummer()){
			     					buttonText = "bereits im Warenkorb";
			     					buttonClass = "disabledBtn";
			     					buttonDisabled = "disabled='diabled'";
			     					break;
			     				}
			     			}
			     		}
			     		
			     		out.println("<div onclick='artikelDetailansichtAnzeigen(" + a.getNummer() + ")' id='artikelListeKundenDesign'>" + 
			     				"<div id='artikelListeKundenBezeichnung'>" + a.getBezeichnung() + "</div>" +
			     				"<div id='artikelListeKundenBild'><img alt='Bild' src='data:image/png;base64," + anzeigenBild + "'/></div>" +
			     						"<form action='warenkorb'>" +
							     	    "<input type='hidden' name='method' value='artikelInDenWarenkorb'>" +
							     	    "<input type='hidden' name='artikelnummer' value='" + a.getNummer() + "'>" +
							     	    "<button id='artikelListeKundenWarenkorbButton' onclick='return verfuegbareMengePruefen2(" + a.getLagermenge() + ");' class='" + buttonClass + "' " + buttonDisabled + ">" + buttonText + "</button>" +
							     	    "</form>" +
			       				"<div id='artikelListeKundenPreis'>" +  formater.format(a.getPreis()) + " &euro;</div>" +    	    
			     			"</div>");
		  
			     	}
		     	}
		     	
       	%>
	</div>
</div>